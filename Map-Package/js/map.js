var map;var markersArray=[];var marker;var infoWindow=new google.maps.InfoWindow;var gPoint;var gId;var geocoder=new google.maps.Geocoder();var ColorList;function initialize(){if(location.search=="?admin"){$("#aAddMarker").show();}$.ajax({type:"GET",cache:false,url:"xml/Settings.xml",dataType:"xml",success:function(b){var d=$(b).find("MapSetting");var c=new google.maps.LatLng(d.find("Lat").text(),d.find("Lng").text());var a={zoom:parseInt(d.find("Zoom").text()),center:c,mapTypeId:d.find("MapType").text()};map=new google.maps.Map(document.getElementById("map_canvas"),a);if(d.find("HiglighAllContinents").text()=="true"){HighlightAll();}}});getPolygonColor();LoadLandMarks();}function HighlightAll(){$.getScript("countries/Asia.js",function(){Poly=new google.maps.Polygon({paths:getPoly(countryCoords),strokeColor:"red",strokeOpacity:0.8,strokeWeight:0,fillColor:"black",fillOpacity:0.5});Poly.setMap(map);});$.getScript("countries/Australia.js",function(){Poly=new google.maps.Polygon({paths:getPoly(countryCoords),strokeColor:"red",strokeOpacity:0.8,strokeWeight:0,fillColor:"black",fillOpacity:0.5});Poly.setMap(map);});$.getScript("countries/Africa.js",function(){Poly=new google.maps.Polygon({paths:getPoly(countryCoords),strokeColor:"red",strokeOpacity:0.8,strokeWeight:0,fillColor:"black",fillOpacity:0.5});Poly.setMap(map);});$.getScript("countries/Europe.js",function(){Poly=new google.maps.Polygon({paths:getPoly(countryCoords),strokeColor:"red",strokeOpacity:0.8,strokeWeight:0,fillColor:"black",fillOpacity:0.5});Poly.setMap(map);});$.getScript("countries/South America.js",function(){Poly=new google.maps.Polygon({paths:getPoly(countryCoords),strokeColor:"red",strokeOpacity:0.8,strokeWeight:0,fillColor:"black",fillOpacity:0.5});Poly.setMap(map);});$.getScript("countries/United States.js",function(){Poly=new google.maps.Polygon({paths:getPoly(countryCoords),strokeColor:"red",strokeOpacity:0.8,strokeWeight:0,fillColor:"black",fillOpacity:0.5});Poly.setMap(map);});$.getScript("countries/Canada.js",function(){Poly=new google.maps.Polygon({paths:getPoly(countryCoords),strokeColor:"red",strokeOpacity:0.8,strokeWeight:0,fillColor:"black",fillOpacity:0.5});Poly.setMap(map);});}function getPolygonColor(){$.ajax({type:"GET",cache:false,url:"xml/ColorList.xml",dataType:"xml",success:function(a){ColorList=a;loadPolygons();}});}function loadPolygons(){$.ajax({type:"GET",url:"xml/CountryList.xml",dataType:"xml",cache:false,success:displayPolygons});}function displayPolygons(a){$(a).find("country").each(function(){var c=$(this).find("Name").text();var e="#333";var b=3;var d;var f=$(this).find("DataValue").text();$(ColorList).find("Range").each(function(){var g=$(this).find("Min").text();var h=$(this).find("Max").text();if(parseFloat(f)>=parseFloat(g)&&parseFloat(f)<=parseFloat(h)){e=$(this).find("Color").text();b=$(this).find("Transparency").text();}});$.getScript("countries/"+c+".js",function(){d=new google.maps.Polygon({paths:getPoly(countryCoords),strokeColor:e,strokeOpacity:0.8,strokeWeight:0,fillColor:e,fillOpacity:b});d.setMap(map);});});}var _st=window.setTimeout;window.setTimeout=function(c,b){if(typeof c=="function"){var a=Array.prototype.slice.call(arguments,2);var d=(function(){c.apply(null,a);});return _st(d,b);}return _st(c,b);};function deleteOverlays(){if(markersArray.length>0){for(idx in markersArray){markersArray[idx].setMap(null);}markersArray.length=0;}}function findMapAddress(b){if(b.keyCode==13){geocoder=new google.maps.Geocoder();var a=document.getElementById("txtMapSearch").value;geocoder.geocode({address:a},function(d,c){if(c==google.maps.GeocoderStatus.OK){map.setCenter(d[0].geometry.location);map.setZoom(11);}else{alert("Location not found!");}});}}function deleteLandMark(b,a){if(confirm("Do you want to delete this Land Mark")){$.ajax({url:"xml/mapData.php",data:{action:"delete",Lat:b,Lng:a},type:"post",success:function(c){LoadLandMarks();}});}}function LoadLandMarks(){deleteOverlays();$.ajax({type:"GET",cache:false,url:"xml/LandMarks.xml",dataType:"xml",success:function(a){$(a).find("LandMark").each(function(){var b=new google.maps.LatLng(parseFloat($(this).attr("Lat")),parseFloat($(this).attr("Lng")));var e;if(location.search=="?admin"){e="<tr><td align='right'><a onclick='deleteLandMark("+$(this).attr("Lat")+","+$(this).attr("Lng")+")'>Delete</a></td></tr>";}else{e="";}var c="<table style='overflow:none'><tr><td style='max-width:300px; vertical-align:top;font-size:17px;'>"+$(this).attr("Description")+"</td></tr>"+e+"</table>";if($(this).attr("LandMarkType")=="TIME"){marker=new CustomMarker(b,map,parseFloat($(this).attr("Offset")),$(this).attr("Description"));}else{if($(this).attr("LandMarkType")=="ICON"){var d=new google.maps.MarkerImage("images/redpin.png");marker=new google.maps.Marker({map:map,position:b,icon:d,title:""});}}markersArray.push(marker);bindInfoWindow(marker,map,infoWindow,c,"old");});}});}function loadXMLDoc(a){if(window.XMLHttpRequest){xhttp=new XMLHttpRequest();}else{xhttp=new ActiveXObject("Microsoft.XMLHTTP");}xhttp.open("GET",a,false);xhttp.send();return xhttp.responseXML;}function saveReport(){$("#aAddMarker").attr("title","Add Marker");var a=$("#CountryName").html();var b=$("#lbMarkerLat").html()+","+$("#lbMarkerLng").html();var d=b.split(",",2);var f=parseFloat(d[0]);var c=parseFloat(d[1]);var e;if($("#chkShowTime").is(":checked")==true){e="TIME";}else{e="ICON";}$.ajax({url:"xml/mapData.php",data:{action:"save",CountryName:a,Lat:f,Lng:c,LandMarkType:e,Descriotion:$("#txtMarkerReport").val(),Address:$("#lbMarkerAddress").html(),Offset:$("#txtOffset").val()},type:"post",success:function(){LoadLandMarks();}});}function setForm(a){gPoint=a.position;gId="lbMarkerAddress";return'<div style="padding 20px; height:170px"><table  style="width:400px;"><tr><td colspan="2" style="font-size:17px;font-weight:bold;color:gray;">Add Landmark</td></tr><tr><td colspan="2"><textarea  rows=4  style="width:379px; height:auto; font-size:12px; font-weight:normal;"  id="txtMarkerReport"></textarea></td></tr><tr><td colspan=2><input id="chkShowTime" type="checkbox"><span style="font-size:11px;color:red"> Show Timezone</span></input>&nbsp;&nbsp;&nbsp; <span style="font-size:11px">Set GMT: </span><input type="text" id="txtOffset" value="0" style="font-size:11px;width:30px" /><span style="font-size:11px"> Example: +5, -4</span></td></tr><tr><td ><label id="lbMarkerLat" style="display:none">'+a.position.lat()+'</label><label style="display:none" id="lbMarkerLng">'+a.position.lng()+'</label><label id="CountryName" style="display:none"></label><label id="lbMarkerAddress"></label></td><td align="right" style="vertical-align:top"><span id="chrDisplay" style="color:red"></span><input type="button" class="buttons" onclick="saveReport()" id="btnMarkerReport" value="Save"/></td></tr></table></div>';}function openMarker(a){google.maps.event.trigger(markersArray[a],"click");}function setFocus(a){document.getElementById(a).focus();}function bindInfoWindow(a,d,c,b,e){if(e!="new"){gId="tdAddressInfo";gPoint=a.position;}google.maps.event.addListener(a,"click",function(){c.setContent(b);c.title=e;c.open(d,a);setTimeout("geocodePosition()",500);});}function geocodePosition(){geocoder.geocode({latLng:gPoint},function(a){if(a&&a.length>0){$("#"+gId).html(a[0].formatted_address);$("#CountryName").html(a[a.length-1].formatted_address);}else{$("#"+gId).html("");}});}function addMarkeronMap(){if($("#aAddMarker").attr("title")==null){return;}$("#aAddMarker").removeAttr("title");marker=new google.maps.Marker({position:map.getCenter(),title:"Drag to set new location",map:map,icon:new google.maps.MarkerImage("images/redpin.png"),draggable:true,id:markersArray.length});markersArray.push(marker);gId="lbMarkerAddress";gPoint=marker.position;bindInfoWindow(marker,map,infoWindow,setForm(marker),"new");openMarker(markersArray.length-1);google.maps.event.addListener(marker,"dragstart",function(){$("#lbMarkerLat").html(marker.position.lat());$("#lbMarkerLng").html(marker.position.lng());});google.maps.event.addListener(marker,"drag",function(){$("#lbMarkerLat").html(marker.position.lat());$("#lbMarkerLng").html(marker.position.lng());});google.maps.event.addListener(marker,"dragend",function(){$("#lbMarkerLat").html(marker.position.lat());$("#lbMarkerLng").html(marker.position.lng());gPoint=marker.position;gId="lbMarkerAddress";geocodePosition();});google.maps.event.addListener(infoWindow,"closeclick",function(){if(infoWindow.title=="new"){markersArray[markersArray.length-1].setMap(null);$("#aAddMarker").attr("title","Add Marker");markersArray.splice(markersArray.length-1,1);}});}function CustomMarker(d,b,c,a){this.latlng_=d;this.offset_=c;this.countryname_=a;this.setMap(b);}CustomMarker.prototype=new google.maps.OverlayView();CustomMarker.prototype.draw=function(){var d=this;var e=this.div_;if(!e){e=this.div_=document.createElement("DIV");e.style.position="absolute";e.style.width="100px";e.style.height="30px";e.style.padding="4px";e.style.cursor="pointer";e.style.background="#000";e.style.color="white";e.style.fontSize="11px";e.align="center";e.style.opacity=0.6;e.style.MozBorderRadius="25px 25px / 1px 25px";e.style.borderRadius="25px 25px / 1px 25px";e.innerHTML=this.countryname_;var b={format:'<span class="dt">%I:%M:%S %P</span>',timeNotation:"12h",am_pm:true,fontFamily:"Verdana, Times New Roman",fontSize:"11px",foreground:"white",background:"#000",utc:true,utc_offset:this.offset_};divTime=document.createElement("DIV");$(divTime).jclock(b);$(e).append(divTime);google.maps.event.addDomListener(e,"click",function(f){google.maps.event.trigger(d,"click");});var c=this.getPanes();c.overlayImage.appendChild(e);}var a=this.getProjection().fromLatLngToDivPixel(this.latlng_);if(a){e.style.left=a.x+"px";e.style.top=a.y+"px";}};CustomMarker.prototype.remove=function(){if(this.div_){this.div_.parentNode.removeChild(this.div_);this.div_=null;}};CustomMarker.prototype.getPosition=function(){return this.latlng_;};function getPoly(f){var d=[];var c;var g;var e;var b;var h=f.indexOf("((");while(h>-1){c=h+2;h=f.indexOf("((",h+1);if(h<0){g=f.length-2;}else{g=h-4;}e=f.substring(c,g);e=e.split(",",e.length);var i=[];for(var a=0;a<e.length;a++){b=e[a].trim().split(" ");i.push(new google.maps.LatLng(b[1],b[0]));}d.push(i);}return d;}